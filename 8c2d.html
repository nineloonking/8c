<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<title>今日四柱八字</title>
</head>

<body>


	<input type="date" id="mydate" onchange="datechanged()" >
	<input type="time" id="mytime" onchange="datechanged()" >
				
<div id="here"></div>

<script>  

var datelist = [
'2026-01-05T08:23:00Z',
'2026-01-20T01:45:00Z',
'2026-02-03T20:02:00Z',
'2026-02-18T15:52:00Z',
'2026-03-05T13:59:00Z',
'2026-03-20T14:46:00Z',
'2026-04-04T18:40:00Z',
'2026-04-20T01:39:00Z',
'2026-05-05T11:49:00Z',
'2026-05-21T00:37:00Z',
'2026-06-05T16:17:00Z',
'2026-06-21T09:59:00Z',
'2026-07-07T03:32:00Z',
'2026-07-22T21:01:00Z',
'2026-08-07T13:13:00Z',
'2026-08-23T03:46:00Z',
'2026-09-07T15:58:00Z',
'2026-09-23T01:24:00Z',
'2026-10-08T07:40:00Z',
'2026-10-23T10:47:00Z',
'2026-11-07T10:49:00Z',
'2026-11-22T08:27:00Z',
'2026-12-07T03:52:00Z',
'2026-12-21T21:58:00Z'
];
  
var workingdates = datelist;

function getinrange(number,range){

      while (number > range){number = number - range}

      while (number <= 0.0){number = number+range}            

        return number;

}

function finddifference(StartDate,EndDate)
{        
let enddatetemp = new Date(EndDate);

const oneDay = 24 * 60 * 60 * 1000; // hours*minutes*seconds*milliseconds
enddatetemp.setHours(0, 0, 0); StartDate.setHours(0, 0, 0);
const diffDays = Math.round(Math.abs((enddatetemp - StartDate) / oneDay));

return diffDays
					
			
} //Function FindDifference ends here

function findSurroundingDates(dateArray, targetDate) {
  const target = new Date(targetDate).getTime();

  let low = 0;
  let high = dateArray.length - 1;

  // Edge cases
  if (target < new Date(dateArray[0]).getTime()) {
    return { beforeIndex: null, afterIndex: 0 };
  }
  if (target > new Date(dateArray[high]).getTime()) {
    return { beforeIndex: high, afterIndex: null };
  }

  // Binary search
  while (low <= high) {
    const mid = Math.floor((low + high) / 2);
    const midTime = new Date(dateArray[mid]).getTime();

    if (midTime === target) {
      return { beforeIndex: mid, afterIndex: mid }; // Exact match
    } else if (midTime < target) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }

  // At this point, high < low. The target is between dateArray[high] and dateArray[low]
  return { beforeIndex: high, afterIndex: low };
}

	document.getElementById('mydate').valueAsDate = new Date();
	document.getElementById('mytime').valueAsDate = new Date();
function datechanged(){
	
	
	
	
if (true) {
	
	
	//Change this if needed:
	dateEntered = document.getElementById('mydate').valueAsDate;
	dateafteradjustment = dateEntered;
	
	
	var hours = document.getElementById('mytime').valueAsDate.getHours();
	var minutes = document.getElementById('mytime').valueAsDate.getMinutes();
	dateEntered.setHours(hours, minutes, 0, 0);
		
	if (dateafteradjustment.getFullYear() != 2026) {
	  here.innerHTML = '僅適用於2026年';
	  return;
	}
	
	
		var comparedate = new Date(); comparedate.setFullYear(1); comparedate.setDate(1);comparedate.setMonth(0); 
		var datediff = finddifference(comparedate,dateafteradjustment);
		//DayPillar Calculations Here
					daystem = getinrange((datediff % 10) + 6,10);
					daybranch = getinrange((datediff % 12) +4,12);		
					
		//Solar Term and Solar Month start both here
		
		
		
		let surroundingindex = findSurroundingDates(workingdates, dateEntered.toISOString() );
		var previoussolartermindex = surroundingindex.beforeIndex;
		if (previoussolartermindex === null) {
		  previoussolartermindex = -1;
		}
		

		
		// Year calculation
		var year = dateafteradjustment.getFullYear();
		var yearstem = ((year - 3) % 10) || 10;
		var yearbranch = ((year - 3) % 12) || 12;
		
		// Adjust year if before Li Chun
		if (previoussolartermindex < 2) {
		  yearstem = getinrange(yearstem - 1, 10);
		  yearbranch = getinrange(yearbranch - 1, 12);
		}
	
		// Month calculation
		let last_jie_index;
		if (previoussolartermindex === -1) {
		  last_jie_index = 22;
		} else {
		  const is_zhong = previoussolartermindex % 2 === 1;
		  last_jie_index = is_zhong ? previoussolartermindex - 1 : previoussolartermindex;
		}
		var monthbranch = getinrange((last_jie_index / 2) + 2, 12);
		var solarmonth = getinrange(monthbranch - 2, 12);
		
		// Month stem
		var monthstem = getinrange(((yearstem % 5) * 2) + solarmonth, 10);
		
		
		//Hour Start here
		var hourbranch = (Math.floor((hours + 1) / 2) % 12) + 1;
		
		var starting_stem = ((daystem * 2 - 1) % 10) || 10;
		var hourstem = getinrange(starting_stem + hourbranch - 1, 10);
		
		
		
		
		var branchespinyin = ["", "Zi ", "Chou","Yin","Mao","Chen","Si ","Wu ","Wei","Shen","You","Xu ","Hai"];
		var BranchesNamesshort = ["","Zi子","Chou丑" ,"Yin寅","Mao卯","Chen辰","Si巳","Wu午","Wei未","Shen申", "You酉", "Xu戌", "Hai亥"]
		
		var stemspinyin = ["", "Jia","Yi","Bing","Ding","Wu","Ji","Geng","Xin","Ren","Gui"];
		var stems = ["", "甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
		
		here.innerHTML = `
		<table>
		<tr><td>時柱</td><td>日柱</td><td>月柱</td><td>年柱</td></tr>
		<tr><td>`+stemspinyin[hourstem]+stems[hourstem]+`</td><td>`+stemspinyin[daystem]+stems[daystem]+`</td><td>`+stemspinyin[monthstem]+stems[monthstem]+`</td><td>`+stemspinyin[yearstem]+stems[yearstem]+`</td></tr>
		<tr><td>`+BranchesNamesshort[hourbranch]+`</td><td>`+BranchesNamesshort[daybranch]+`</td><td>`+BranchesNamesshort[monthbranch]+`</td><td>`+BranchesNamesshort[yearbranch]+`</td></tr></table>`
	}//Closing Flow

}//Closing Date Changed


datechanged();

</script>



</body>
</html>
